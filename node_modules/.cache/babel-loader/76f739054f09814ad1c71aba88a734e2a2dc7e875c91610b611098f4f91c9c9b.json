{"ast":null,"code":"var _jsxFileName = \"C:\\\\laragon\\\\www\\\\sales-automation\\\\sales\\\\src\\\\components\\\\misc\\\\GroupBlock.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport DatePicker from 'react-datepicker';\nimport moment from 'moment';\nimport 'react-datepicker/dist/react-datepicker.css';\nimport { useParams } from \"react-router-dom\";\nimport Button from \"./Button\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst apiURL = process.env.REACT_APP_BASE_URL_LIVE;\nconst Block = ({\n  group,\n  setGroup,\n  setToggler,\n  toggler,\n  fromDate,\n  setFromDate,\n  toDate,\n  setToDate,\n  filterData,\n  setFilterData,\n  allGroups,\n  setAllGroups\n}) => {\n  _s();\n  const [groupName, setGroupName] = useState();\n  const [active, setActive] = useState(false);\n  const [forwardNumber, setForwardNumber] = useState();\n  const [chats, setAllChats] = useState(null);\n  const [chatWithPhone, setChatWithPhone] = useState(null);\n  const [transformedData, setTransfromedData] = useState();\n  const [errorMessage, setErrorMessage] = useState(null);\n  const [file, setFile] = useState(null);\n  const [selectedGroupId, setSelectedGroupId] = useState(\"\");\n  const [phoneNumber, setPhoneNumber] = useState(\"\");\n  const [concur, setConcur] = useState();\n  const [trunkId, setTrunkId] = useState();\n  let {\n    id\n  } = useParams();\n  useEffect(() => {\n    setSelectedGroupId(id);\n    axios.get(`${apiURL}/api/concurrent-number`).then(res => {\n      var _res$data;\n      setConcur(res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.concurrentNumber.con);\n    }).catch(err => {\n      console.log(err);\n    });\n    axios.get(`${apiURL}/api/getSipSetting`).then(res => {\n      setTrunkId(res.data.data.UserName);\n    }).catch(err => {\n      console.log(\"error ::\", err);\n    });\n  }, []);\n\n  // upload excel file\n\n  const handleUploadFile = () => {\n    if (!file) {\n      return;\n    }\n    const formData = new FormData();\n    formData.append('excel_file', file);\n    formData.append('id', id);\n    fetch(`${apiURL}/api/upload-excel`, {\n      method: 'POST',\n      body: formData\n    }).then(response => console.log(response)).then(data => {}).catch(error => {});\n    alert('Uploaded Successfully');\n  };\n  const handleGroup = () => {\n    axios.post(`${apiURL}/api/create-group`, {\n      name: groupName,\n      phoneNumbers: []\n    }).then(response => {\n      alert(\"Success: Group Created Successfully\");\n    });\n  };\n\n  // useEffect(() => {\n  //   axios.get(`${apiUrl}/api/groups`).then((response) => {\n  //     setAllGroups(response.data.groups);\n  //   });\n  // }, []);\n\n  const firstData = () => {\n    setAllGroups(null);\n    setForwardNumber(null);\n    axios.get(`${apiURL}/api/groups`).then(response => {\n      setAllGroups(response.data.groups);\n    }).catch(err => console.log(err.message));\n    axios.get(`${apiURL}/api/forwarding`).then(response => {\n      // setForwardNumber(response.data.groups);\n      setForwardNumber(response.data.forwardingNumbers[0].number);\n    }).catch(err => console.log(err));\n  };\n  useEffect(() => {\n    firstData();\n\n    // axios.get(`${apiURL}/api/concurrent-number`)\n    //   .then((res) => {\n    //     setConcur(res?.data?.concurrentNumber)\n    //   })\n    //   .catch((err) => {\n    //   })\n\n    console.log(active);\n  }, []);\n\n  // Function to extract the number inside the angle brackets from the clid property\n  const extractNumberFromClid = clid => {\n    const regex = /<(\\d{1,})>/;\n    const match = clid.match(regex);\n    return match && match[1] ? match[1] : null;\n  };\n\n  // Update the clid property for each chat object\n  const updatedChats = chats === null || chats === void 0 ? void 0 : chats.map(chat => {\n    const extractedNumber = extractNumberFromClid(chat.clid);\n    return {\n      ...chat,\n      clid: extractedNumber ? extractedNumber : chat.clid\n    };\n  });\n  useEffect(() => {\n    setChatWithPhone(updatedChats);\n  }, [chats]);\n  function divideArrayIntoSubarrays(array, subarraySize) {\n    const dividedArrays = [];\n    for (let i = 0; i < array.length; i += subarraySize) {\n      const subarray = array.slice(i, i + subarraySize);\n      dividedArrays.push(subarray);\n    }\n    return dividedArrays;\n  }\n\n  // const handleCalling = () => {\n  //   if(active){\n  //     console.log('calls has been ended');\n  //     setActive(false)\n  //   }\n  //   setActive(true)\n  //   let phoneNumbers = [];\n  //   allGroups?.filter((itm) => {\n  //     if (selectedGroupId) {\n  //       return itm?._id === selectedGroupId\n  //     } else {\n  //       return true;\n  //     }\n  //   }).forEach((group, index) => {\n  //     group.phoneNumbers?.forEach((item, subIndex) => {\n  //       if (item?.number) {\n  //         phoneNumbers.push(\"96\" + item?.number);\n  //       } else {\n  //         phoneNumbers.push(\"96\" + item);\n  //       }\n  //     });\n  //   });\n\n  //   // there should be a loop here\n\n  //   // console.log('---------------------------------------', phoneNumbers)\n  //   // const subarraySize = 5; // Specify the size of each subarray\n  //   // const dividedArrays = divideArrayIntoSubarrays(phoneNumbers, subarraySize);\n  //   // console.log('***********', dividedArrays)\n\n  //   let tempPhone = [\n  //     {\n  //       calls: \"2\",\n  //       trunk: \"1001\",\n  //       forward: forwardNumber,\n  //     },\n  //     phoneNumbers,\n  //   ];\n\n  //   axios\n  //     .post(\n  //       `${apiURL}/api/call-numbers`,\n  //       tempPhone\n  //     )\n  //     .then((response) => alert('Calling Status Changed!'))\n  //     .catch((err) => {\n  //       setActive(false)\n  //       alert('Something failed! Try again Later')\n  //     })\n\n  //     console.log(active);\n\n  // };\n\n  const handleCalling = () => {\n    if (active) {\n      axios.get(`${apiURL}/api/stop-calling`).then(response => alert('Calls have been ended')).catch(err => alert('Something failed! Try again Later'));\n      setActive(false);\n    } else {\n      setActive(true);\n      let phoneNumbers = [];\n      allGroups === null || allGroups === void 0 ? void 0 : allGroups.filter(itm => {\n        if (selectedGroupId) {\n          return (itm === null || itm === void 0 ? void 0 : itm._id) === selectedGroupId;\n        } else {\n          return true;\n        }\n      }).forEach((group, index) => {\n        var _group$phoneNumbers;\n        (_group$phoneNumbers = group.phoneNumbers) === null || _group$phoneNumbers === void 0 ? void 0 : _group$phoneNumbers.forEach((item, subIndex) => {\n          if (item !== null && item !== void 0 && item.number) {\n            phoneNumbers.push(\"96\" + (item === null || item === void 0 ? void 0 : item.number));\n          } else {\n            phoneNumbers.push(\"96\" + item);\n          }\n        });\n      });\n      let tempPhone = [{\n        calls: concur,\n        trunk: \"trk-\" + trunkId,\n        forward: forwardNumber\n      }, phoneNumbers];\n      axios.post(`${apiURL}/api/call-numbers`, tempPhone).then(response => alert('Calling Status Changed!')).catch(err => {\n        setActive(false);\n        alert('Something failed! Try again Later');\n      });\n    }\n    console.log(active);\n  };\n  const handleAddPhoneNumber = () => {\n    setSelectedGroupId(id);\n    if (!id || !phoneNumber) {\n      alert(\"Please select a group and provide a phone number.\", id, phoneNumber);\n      return;\n    }\n    const newPhoneNumberData = {\n      groupId: selectedGroupId,\n      phoneNumber: phoneNumber,\n      status: \"calling\",\n      // Example status value\n      duration: \"10s\",\n      // Example duration value\n      keyword: \"yes\",\n      // Example keyword value\n      answered: \"yes\" // Example answered value\n    };\n\n    axios.post(`${apiURL}/api/add-phone-number`, {\n      groupId: selectedGroupId,\n      phoneNumber: phoneNumber\n    }).then(response => {\n      console.log(response);\n      firstData();\n      alert(\"Successfully added a new phone number\");\n    });\n\n    // Clear the input fields after adding the phone number\n    // setSelectedGroupId(\"\");\n    // setPhoneNumber(\"\");\n  };\n\n  const [isChecked, setIsChecked] = useState(false);\n  const handleToggle = () => {\n    localStorage.setItem(\"toggle\", !isChecked);\n    setIsChecked(!isChecked);\n    setToggler(!isChecked);\n  };\n\n  //from and to date filter handling here\n  const filterHandler = () => {\n    if (fromDate && toDate) {\n      const filterResult = group === null || group === void 0 ? void 0 : group.phoneNumbers.filter(item => {\n        const itemDate = moment(item === null || item === void 0 ? void 0 : item.createdAt).format('YYYY/MM/DD');\n        return itemDate >= fromDate && itemDate <= toDate;\n      });\n      setFilterData(filterResult);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-white shadow-md sm:rounded-lg flex justify-end p-8 flex-wrap gap-3\",\n    \"data-testid\": \"groupBlockContainer\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full flex gap-2 items-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"font-medium\",\n          children: \"Group Name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-8/12\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"group--block--input rounded\",\n          value: groupName,\n          onChange: e => {\n            setGroupName(e.target.value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          text: \"Add Group\",\n          onClick: handleGroup,\n          active: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full flex gap-2 items-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-6/12\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Add phone Number\",\n          className: \"group--block--input rounded\",\n          value: phoneNumber,\n          onChange: e => setPhoneNumber(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-3/12\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          text: \"Add Phone\",\n          onClick: handleAddPhoneNumber,\n          active: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-3/12\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `btn btn-primary flex gap-1 p-2 rounded items-center w-full white-color`,\n          onClick: handleCalling,\n          style: {\n            background: active ? 'black' : '#256d85'\n          },\n          children: active ? 'Stop Calling' : 'Start Calling'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full flex gap-2 items-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-4/12 flex items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"font-medium w-40 mr-4\",\n          style: {\n            textWrap: 'nowrap'\n          },\n          children: \"Upload Excel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          className: \"group--block--input rounded w-1/2\",\n          id: \"file_input\",\n          onChange: e => {\n            setFile(e.target.files[0]);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            handleUploadFile();\n          },\n          className: \"btn btn-primary flex gap-1 p-2 rounded items-center bg--active white-color button--main--color\",\n          children: \"Upload\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"fromDate\",\n          value: fromDate,\n          onChange: e => setFromDate(e.target.value),\n          className: \"group--block--input rounded\",\n          placeholder: \"YYYY/MM/DD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(DatePicker, {\n          customInput: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"/imgs/calendar.svg\",\n            style: {\n              width: \"2rem\",\n              height: \"2rem\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 399,\n            columnNumber: 26\n          }, this),\n          maxDate: new Date(),\n          onChange: date => setFromDate(moment(date).format('YYYY/MM/DD'))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"toDate\",\n          value: toDate,\n          onChange: e => setToDate(e.target.value),\n          className: \"group--block--input rounded\",\n          placeholder: \"YYYY/MM/DD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(DatePicker, {\n          customInput: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"/imgs/calendar.svg\",\n            style: {\n              width: \"2rem\",\n              height: \"2rem\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 26\n          }, this),\n          maxDate: new Date(),\n          onChange: date => {\n            setToDate(moment(date).format('YYYY/MM/DD'));\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-2/12\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          text: \"Filter\",\n          onClick: filterHandler,\n          active: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 423,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center space-x-4\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"flex items-center cursor-pointer\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            className: \"sr-only\",\n            checked: isChecked,\n            onChange: handleToggle\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 431,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `block bg-gray-600 w-10 h-6 rounded-full transition ${isChecked ? \"bg-green-500\" : \"bg-gray-600\"}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 437,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `dot absolute  top-1 w-4 h-4 rounded-full transition ${isChecked ? \"bg-white left-5\" : \"bg-gray-400 left-1\"}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ml-3 text-gray-700 font-medium\",\n          children: \"Filter Answered\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 7\n    }, this), errorMessage && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400 absolute top-2 left-50\",\n        role: \"alert\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          class: \"font-medium\",\n          children: \"Danger alert!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 13\n        }, this), \" \", errorMessage]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 452,\n        columnNumber: 11\n      }, this)\n    }, void 0, false)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 310,\n    columnNumber: 5\n  }, this);\n};\n_s(Block, \"osA3nfeVnb8sI0nYC6xWEpsZjm0=\", false, function () {\n  return [useParams];\n});\n_c = Block;\nexport default Block;\nvar _c;\n$RefreshReg$(_c, \"Block\");","map":{"version":3,"names":["React","useEffect","useState","DatePicker","moment","useParams","Button","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","apiURL","process","env","REACT_APP_BASE_URL_LIVE","Block","group","setGroup","setToggler","toggler","fromDate","setFromDate","toDate","setToDate","filterData","setFilterData","allGroups","setAllGroups","_s","groupName","setGroupName","active","setActive","forwardNumber","setForwardNumber","chats","setAllChats","chatWithPhone","setChatWithPhone","transformedData","setTransfromedData","errorMessage","setErrorMessage","file","setFile","selectedGroupId","setSelectedGroupId","phoneNumber","setPhoneNumber","concur","setConcur","trunkId","setTrunkId","id","get","then","res","_res$data","data","concurrentNumber","con","catch","err","console","log","UserName","handleUploadFile","formData","FormData","append","fetch","method","body","response","error","alert","handleGroup","post","name","phoneNumbers","firstData","groups","message","forwardingNumbers","number","extractNumberFromClid","clid","regex","match","updatedChats","map","chat","extractedNumber","divideArrayIntoSubarrays","array","subarraySize","dividedArrays","i","length","subarray","slice","push","handleCalling","filter","itm","_id","forEach","index","_group$phoneNumbers","item","subIndex","tempPhone","calls","trunk","forward","handleAddPhoneNumber","newPhoneNumberData","groupId","status","duration","keyword","answered","isChecked","setIsChecked","handleToggle","localStorage","setItem","filterHandler","filterResult","itemDate","createdAt","format","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","value","onChange","e","target","text","onClick","placeholder","style","background","textWrap","files","customInput","src","width","height","maxDate","Date","date","checked","class","role","_c","$RefreshReg$"],"sources":["C:/laragon/www/sales-automation/sales/src/components/misc/GroupBlock.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport DatePicker from 'react-datepicker';\r\nimport moment from 'moment';\r\nimport 'react-datepicker/dist/react-datepicker.css';\r\nimport { useParams } from \"react-router-dom\";\r\nimport Button from \"./Button\";\r\nimport axios from \"axios\";\r\n\r\nconst apiURL = process.env.REACT_APP_BASE_URL_LIVE;\r\n\r\n\r\nconst Block = ({ group, setGroup, setToggler, toggler, fromDate, setFromDate, toDate, setToDate, filterData, setFilterData, allGroups, setAllGroups }) => {\r\n  const [groupName, setGroupName] = useState();\r\n  const [active, setActive] = useState(false)\r\n  const [forwardNumber, setForwardNumber] = useState();\r\n  const [chats, setAllChats] = useState(null);\r\n  const [chatWithPhone, setChatWithPhone] = useState(null);\r\n  const [transformedData, setTransfromedData] = useState();\r\n  const [errorMessage, setErrorMessage] = useState(null)\r\n  const [file, setFile] = useState(null)\r\n  const [selectedGroupId, setSelectedGroupId] = useState(\"\");\r\n  const [phoneNumber, setPhoneNumber] = useState(\"\");\r\n  const [concur, setConcur] = useState();\r\n  const [trunkId, setTrunkId] = useState();\r\n\r\n  let { id } = useParams();\r\n\r\n\r\n  useEffect(() => {\r\n    setSelectedGroupId(id)\r\n    axios.get(`${apiURL}/api/concurrent-number`)\r\n      .then((res) => {\r\n        setConcur(res?.data?.concurrentNumber.con)\r\n      })\r\n      .catch((err) => {\r\n        console.log(err)\r\n      })\r\n\r\n      axios.get(`${apiURL}/api/getSipSetting`).then((res) => {\r\n        setTrunkId(res.data.data.UserName)\r\n    }).catch((err) => {\r\n        console.log(\"error ::\", err)\r\n    });\r\n  }, [])\r\n\r\n  // upload excel file\r\n\r\n  const handleUploadFile = () => {\r\n    if (!file) {\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append('excel_file', file);\r\n    formData.append('id', id);\r\n\r\n    fetch(`${apiURL}/api/upload-excel`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    })\r\n      .then((response) => console.log(response))\r\n      .then((data) => {\r\n      })\r\n      .catch((error) => {\r\n      });\r\n\r\n    alert('Uploaded Successfully');\r\n  };\r\n\r\n\r\n\r\n  const handleGroup = () => {\r\n    axios\r\n      .post(`${apiURL}/api/create-group`, {\r\n        name: groupName,\r\n        phoneNumbers: [],\r\n      })\r\n      .then((response) => {\r\n        alert(\"Success: Group Created Successfully\");\r\n      });\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   axios.get(`${apiUrl}/api/groups`).then((response) => {\r\n  //     setAllGroups(response.data.groups);\r\n  //   });\r\n  // }, []);\r\n\r\n\r\n  const firstData = () => {\r\n    setAllGroups(null)\r\n    setForwardNumber(null)\r\n    axios.get(`${apiURL}/api/groups`).then((response) => {\r\n      setAllGroups(response.data.groups);\r\n    })\r\n      .catch((err) => console.log(err.message));\r\n    axios.get(`${apiURL}/api/forwarding`).then((response) => {\r\n      // setForwardNumber(response.data.groups);\r\n      setForwardNumber(response.data.forwardingNumbers[0].number);\r\n    })\r\n      .catch((err) => console.log(err));\r\n  }\r\n\r\n\r\n  useEffect(() => {\r\n    firstData()\r\n\r\n    // axios.get(`${apiURL}/api/concurrent-number`)\r\n    //   .then((res) => {\r\n    //     setConcur(res?.data?.concurrentNumber)\r\n    //   })\r\n    //   .catch((err) => {\r\n    //   })\r\n\r\n      console.log(active);\r\n  }, []);\r\n\r\n  // Function to extract the number inside the angle brackets from the clid property\r\n  const extractNumberFromClid = (clid) => {\r\n    const regex = /<(\\d{1,})>/;\r\n    const match = clid.match(regex);\r\n    return match && match[1] ? match[1] : null;\r\n  };\r\n\r\n  // Update the clid property for each chat object\r\n  const updatedChats = chats?.map((chat) => {\r\n    const extractedNumber = extractNumberFromClid(chat.clid);\r\n    return {\r\n      ...chat,\r\n      clid: extractedNumber ? extractedNumber : chat.clid,\r\n    };\r\n  });\r\n\r\n  useEffect(() => {\r\n    setChatWithPhone(updatedChats);\r\n  }, [chats]);\r\n  \r\n\r\n\r\n  function divideArrayIntoSubarrays(array, subarraySize) {\r\n    const dividedArrays = [];\r\n\r\n    for (let i = 0; i < array.length; i += subarraySize) {\r\n      const subarray = array.slice(i, i + subarraySize);\r\n      dividedArrays.push(subarray);\r\n    }\r\n\r\n    return dividedArrays;\r\n  }\r\n\r\n\r\n  // const handleCalling = () => {\r\n  //   if(active){\r\n  //     console.log('calls has been ended');\r\n  //     setActive(false)\r\n  //   }\r\n  //   setActive(true)\r\n  //   let phoneNumbers = [];\r\n  //   allGroups?.filter((itm) => {\r\n  //     if (selectedGroupId) {\r\n  //       return itm?._id === selectedGroupId\r\n  //     } else {\r\n  //       return true;\r\n  //     }\r\n  //   }).forEach((group, index) => {\r\n  //     group.phoneNumbers?.forEach((item, subIndex) => {\r\n  //       if (item?.number) {\r\n  //         phoneNumbers.push(\"96\" + item?.number);\r\n  //       } else {\r\n  //         phoneNumbers.push(\"96\" + item);\r\n  //       }\r\n  //     });\r\n  //   });\r\n\r\n  //   // there should be a loop here\r\n\r\n  //   // console.log('---------------------------------------', phoneNumbers)\r\n  //   // const subarraySize = 5; // Specify the size of each subarray\r\n  //   // const dividedArrays = divideArrayIntoSubarrays(phoneNumbers, subarraySize);\r\n  //   // console.log('***********', dividedArrays)\r\n\r\n  //   let tempPhone = [\r\n  //     {\r\n  //       calls: \"2\",\r\n  //       trunk: \"1001\",\r\n  //       forward: forwardNumber,\r\n  //     },\r\n  //     phoneNumbers,\r\n  //   ];\r\n\r\n  //   axios\r\n  //     .post(\r\n  //       `${apiURL}/api/call-numbers`,\r\n  //       tempPhone\r\n  //     )\r\n  //     .then((response) => alert('Calling Status Changed!'))\r\n  //     .catch((err) => {\r\n  //       setActive(false)\r\n  //       alert('Something failed! Try again Later')\r\n  //     })\r\n\r\n  //     console.log(active);\r\n\r\n  // };\r\n\r\n\r\n  const handleCalling = () => {\r\n    if (active) {\r\n      axios\r\n      .get(`${apiURL}/api/stop-calling`)\r\n      .then((response) => alert('Calls have been ended'))\r\n      .catch((err) => alert('Something failed! Try again Later'));\r\n      setActive(false);\r\n    } else {\r\n      setActive(true);\r\n      let phoneNumbers = [];\r\n      allGroups?.filter((itm) => {\r\n        if (selectedGroupId) {\r\n          return itm?._id === selectedGroupId;\r\n        } else {\r\n          return true;\r\n        }\r\n      }).forEach((group, index) => {\r\n        group.phoneNumbers?.forEach((item, subIndex) => {\r\n          if (item?.number) {\r\n            phoneNumbers.push(\"96\" + item?.number);\r\n          } else {\r\n            phoneNumbers.push(\"96\" + item);\r\n          }\r\n        });\r\n      });\r\n  \r\n      let tempPhone = [\r\n        {\r\n          calls: concur,\r\n          trunk: \"trk-\"+trunkId,\r\n          forward: forwardNumber,\r\n        },\r\n        phoneNumbers,\r\n      ];\r\n  \r\n      axios\r\n        .post(`${apiURL}/api/call-numbers`, tempPhone)\r\n        .then((response) => alert('Calling Status Changed!'))\r\n        .catch((err) => {\r\n          setActive(false);\r\n          alert('Something failed! Try again Later');\r\n        });\r\n    }\r\n  \r\n    console.log(active);\r\n  };\r\n  \r\n  const handleAddPhoneNumber = () => {\r\n\r\n    setSelectedGroupId(id)\r\n    if (!id || !phoneNumber) {\r\n      alert(\"Please select a group and provide a phone number.\", id, phoneNumber);\r\n      return;\r\n    }\r\n\r\n    const newPhoneNumberData = {\r\n      groupId: selectedGroupId,\r\n      phoneNumber: phoneNumber,\r\n      status: \"calling\", // Example status value\r\n      duration: \"10s\", // Example duration value\r\n      keyword: \"yes\", // Example keyword value\r\n      answered: \"yes\", // Example answered value\r\n    };\r\n\r\n    axios\r\n      .post(`${apiURL}/api/add-phone-number`, {\r\n        groupId: selectedGroupId,\r\n        phoneNumber: phoneNumber,\r\n      })\r\n      .then((response) => {\r\n        console.log(response)\r\n        firstData()\r\n        alert(\"Successfully added a new phone number\");\r\n      });\r\n\r\n    // Clear the input fields after adding the phone number\r\n    // setSelectedGroupId(\"\");\r\n    // setPhoneNumber(\"\");\r\n  };\r\n\r\n  const [isChecked, setIsChecked] = useState(false);\r\n\r\n  const handleToggle = () => {\r\n    localStorage.setItem(\"toggle\", !isChecked);\r\n    setIsChecked(!isChecked);\r\n    setToggler(!isChecked);\r\n  };\r\n\r\n\r\n  //from and to date filter handling here\r\n  const filterHandler = () => {\r\n    if (fromDate && toDate) {\r\n      const filterResult = group?.phoneNumbers.filter(item => {\r\n        const itemDate = moment(item?.createdAt).format('YYYY/MM/DD');\r\n        return itemDate >= fromDate && itemDate <= toDate;\r\n      });\r\n\r\n      setFilterData(filterResult);\r\n    }\r\n  }\r\n\r\n\r\n  return (\r\n    <div className=\"bg-white shadow-md sm:rounded-lg flex justify-end p-8 flex-wrap gap-3\" data-testid=\"groupBlockContainer\">\r\n\r\n      <div className=\"w-full flex gap-2 items-center\">\r\n        <div className=\"w-2/12\">\r\n          <p className=\"font-medium\">Group Name</p>\r\n        </div>\r\n        <div className=\"w-8/12\">\r\n          <input\r\n            type=\"text\"\r\n            className=\"group--block--input rounded\"\r\n            value={groupName}\r\n            onChange={(e) => {\r\n              setGroupName(e.target.value);\r\n            }}\r\n          />\r\n        </div>\r\n        <div className=\"w-2/12\">\r\n          <Button text=\"Add Group\" onClick={handleGroup} active />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"w-full flex gap-2 items-center\">\r\n        {/* <div className=\"w-2/12\">\r\n                    <Button text='Upload Phone .xls' active />\r\n                </div> */}\r\n        {/* <div className=\"w-6/12\">\r\n          <select\r\n            className=\"group--block--input rounded\"\r\n            value={selectedGroupId}\r\n            onChange={(e) => setSelectedGroupId(e.target.value)}\r\n          >\r\n            <option value=\"\">Select a Group</option>\r\n            {allGroups?.map((group) => (\r\n              <option key={group._id} value={group._id}>\r\n                {group.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div> */}\r\n        <div className=\"w-6/12\">\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Add phone Number\"\r\n            className=\"group--block--input rounded\"\r\n            value={phoneNumber}\r\n            onChange={(e) => setPhoneNumber(e.target.value)}\r\n          />\r\n        </div>\r\n        <div className=\"w-3/12\">\r\n          <Button text=\"Add Phone\" onClick={handleAddPhoneNumber} active />\r\n        </div>\r\n        <div className=\"w-3/12\">\r\n        <button\r\n      className={`btn btn-primary flex gap-1 p-2 rounded items-center w-full white-color`}\r\n      onClick={handleCalling}\r\n      style={{ background: active ?  'black' : '#256d85' }}\r\n    >\r\n      {active ? 'Stop Calling' : 'Start Calling'}\r\n    </button>\r\n          {/* <button className=\"btn btn-primary flex gap-1 p-2 rounded items-center   w-full white-color \" style={{ background: active ? '#256d85' : 'black' }} onClick={handleCalling}>Start / Stop Calling</button> */}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"w-full flex gap-2 items-center\">\r\n        <div className=\"w-4/12 flex items-center\">\r\n          <p className=\"font-medium w-40 mr-4\" style={{ textWrap: 'nowrap' }}>Upload Excel</p>\r\n          <input\r\n            type=\"file\"\r\n            className=\"group--block--input rounded w-1/2\"\r\n            id=\"file_input\"\r\n            onChange={(e) => { setFile(e.target.files[0]) }}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"w-2/12\">\r\n          <button onClick={() => { handleUploadFile() }} className=\"btn btn-primary flex gap-1 p-2 rounded items-center bg--active white-color button--main--color\">Upload</button>\r\n        </div>\r\n        <div className=\"w-2/12\">\r\n          <input\r\n            type=\"text\"\r\n            name=\"fromDate\"\r\n            value={fromDate}\r\n            onChange={(e) => setFromDate(e.target.value)}\r\n            className=\"group--block--input rounded\"\r\n            placeholder=\"YYYY/MM/DD\"\r\n          />\r\n        </div>\r\n        <div className=\"w-2/12\">\r\n          <DatePicker\r\n            customInput={<img src=\"/imgs/calendar.svg\" style={{ width: \"2rem\", height: \"2rem\" }} />}\r\n            maxDate={new Date()}\r\n            onChange={(date) => setFromDate(moment(date).format('YYYY/MM/DD'))}\r\n          />\r\n        </div>\r\n        <div className=\"w-2/12\">\r\n          <input\r\n            type=\"text\"\r\n            name=\"toDate\"\r\n            value={toDate}\r\n            onChange={(e) => setToDate(e.target.value)}\r\n            className=\"group--block--input rounded\"\r\n            placeholder=\"YYYY/MM/DD\"\r\n          />\r\n        </div>\r\n        <div className=\"w-2/12\" >\r\n          <DatePicker\r\n            customInput={<img src=\"/imgs/calendar.svg\" style={{ width: \"2rem\", height: \"2rem\" }} />}\r\n            maxDate={new Date()}\r\n            onChange={(date) => {\r\n              setToDate(moment(date).format('YYYY/MM/DD'))\r\n            }}\r\n          />\r\n        </div>\r\n        <div className=\"w-2/12\">\r\n          <Button text=\"Filter\" onClick={filterHandler} active />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex items-center space-x-4\">\r\n        <label className=\"flex items-center cursor-pointer\">\r\n          <div className=\"relative\">\r\n            <input\r\n              type=\"checkbox\"\r\n              className=\"sr-only\"\r\n              checked={isChecked}\r\n              onChange={handleToggle}\r\n            />\r\n            <div\r\n              className={`block bg-gray-600 w-10 h-6 rounded-full transition ${isChecked ? \"bg-green-500\" : \"bg-gray-600\"\r\n                }`}\r\n            ></div>\r\n            <div\r\n              className={`dot absolute  top-1 w-4 h-4 rounded-full transition ${isChecked ? \"bg-white left-5\" : \"bg-gray-400 left-1\"\r\n                }`}\r\n            ></div>\r\n          </div>\r\n          <div className=\"ml-3 text-gray-700 font-medium\">Filter Answered</div>\r\n        </label>\r\n      </div>\r\n\r\n      {\r\n        errorMessage && <>\r\n          <div class=\"p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400 absolute top-2 left-50\" role=\"alert\">\r\n            <span class=\"font-medium\">Danger alert!</span> {errorMessage}\r\n          </div>\r\n        </>\r\n      }\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Block;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}